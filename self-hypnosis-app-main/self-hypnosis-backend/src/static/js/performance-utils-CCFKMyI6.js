var d=(m,e,t)=>new Promise((o,i)=>{var s=r=>{try{n(t.next(r))}catch(c){i(c)}},a=r=>{try{n(t.throw(r))}catch(c){i(c)}},n=r=>r.done?o(r.value):Promise.resolve(r.value).then(s,a);n((t=t.apply(m,e)).next())});class u{constructor(){this.metrics={componentRenders:new Map,memoryUsage:[],loadTimes:new Map,userInteractions:[]},this.observers=new Set}trackComponentRender(e,t){const o=this.metrics.componentRenders.get(e)||{count:0,totalTime:0};o.count++,o.totalTime+=t,o.averageTime=o.totalTime/o.count,this.metrics.componentRenders.set(e,o)}trackMemoryUsage(){if(performance.memory){const e={timestamp:Date.now(),used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit};this.metrics.memoryUsage.push(e),this.metrics.memoryUsage.length>100&&this.metrics.memoryUsage.shift()}}trackLoadTime(e,t){this.metrics.loadTimes.set(e,t)}getReport(){return{components:Object.fromEntries(this.metrics.componentRenders),memory:this.getMemoryStats(),loadTimes:Object.fromEntries(this.metrics.loadTimes),interactions:this.metrics.userInteractions.length}}getMemoryStats(){if(this.metrics.memoryUsage.length===0)return null;const e=this.metrics.memoryUsage[this.metrics.memoryUsage.length-1],t=Math.max(...this.metrics.memoryUsage.map(i=>i.used)),o=this.metrics.memoryUsage.reduce((i,s)=>i+s.used,0)/this.metrics.memoryUsage.length;return{current:e.used,peak:t,average:o,utilization:e.used/e.total*100}}}class p{constructor(e=3){this.maxConcurrent=e,this.activeAudio=new Map,this.audioPool=[],this.preloadedAudio=new Map}preloadAudio(e,t="low"){return d(this,null,function*(){if(this.preloadedAudio.has(e))return this.preloadedAudio.get(e);const o=new Audio,i=new Promise((s,a)=>{o.addEventListener("canplaythrough",()=>s(o),{once:!0}),o.addEventListener("error",a,{once:!0})});o.preload=t==="high"?"auto":"metadata",o.src=e;try{return yield i,this.preloadedAudio.set(e,o),o}catch(s){return console.warn(`Failed to preload audio: ${e}`,s),null}})}playAudio(o){return d(this,arguments,function*(e,t={}){if(this.activeAudio.size>=this.maxConcurrent){const n=this.activeAudio.keys().next().value;this.stopAudio(n)}let i=this.preloadedAudio.get(e);if(!i&&(i=yield this.preloadAudio(e,"high"),!i))return null;const s=i.cloneNode();s.volume=t.volume||.5,s.loop=t.loop||!1;const a=s.play();return this.activeAudio.set(e,s),s.addEventListener("ended",()=>{this.activeAudio.delete(e)}),a})}stopAudio(e){const t=this.activeAudio.get(e);t&&(t.pause(),t.currentTime=0,this.activeAudio.delete(e))}stopAll(){this.activeAudio.forEach((e,t)=>{e.pause(),e.currentTime=0}),this.activeAudio.clear()}cleanup(){this.stopAll(),this.preloadedAudio.clear(),this.audioPool.length=0}}const l=new u;typeof window!="undefined"&&setInterval(()=>{l.trackMemoryUsage()},5e3);export{p as A,l as p};
